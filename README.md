# ぶきわかるくん API 仕様

## 矩形探査 API

まず [作者の Twitter](https://twitter.com/ryo_hisano) より DM にて、{API_KEY}の申請を行って下さい。

`https://bukiwakaru.herokuapp.com/api/measurement?key={API_KEY}&img={アクセス可能なスクリーンショットの画像URL（https://cdn.discordapp.com/attachments/XXX/YYY/ZZZ.png 等）}`

1.  img パラメータに指定された画像を `bukiwakaru.herokuapp.com` 上に保存
2.  判定しやすいように加工
3.  武器アイコンの矩形を調べその座標を返却

### 成功時レスポンス例

```json
{
  "coordinates": [
    {
      "x": 8,
      "y": 219
    },
    {
      "x": 71,
      "y": 219
    },
    {
      "x": 134,
      "y": 219
    },
    {
      "x": 197,
      "y": 219
    },
    {
      "x": 260,
      "y": 219
    },
    {
      "x": 8,
      "y": 281
    },
    {
      "x": 71,
      "y": 281
    },
    {
      "x": 134,
      "y": 281
    },
    {
      "x": 197,
      "y": 281
    },
    {
      "x": 260,
      "y": 281
    },
    {
      "x": 8,
      "y": 343
    },
    {
      "x": 71,
      "y": 343
    },
    {
      "x": 134,
      "y": 343
    },
    {
      "x": 197,
      "y": 343
    },
    {
      "x": 260,
      "y": 343
    },
    {
      "x": 8,
      "y": 405
    },
    {
      "x": 71,
      "y": 405
    },
    {
      "x": 134,
      "y": 405
    },
    {
      "x": 197,
      "y": 405
    },
    {
      "x": 260,
      "y": 405
    }
  ],
  "img": "20200407082353f2JDr"
}
```

### 失敗時

#### キーの不一致

```json
{
  "error": "APIキーが正しくありません"
}
```

#### 画像が異なる

```json
{
  "error": "画像が正しくありません"
}
```

#### 画像が存在しない

```json
{
  "error": "画像がありません"
}
```

## 武器認識 API

「矩形探査 API」にて取得した img パラメータ及び、X 座標・Y 座標をそれぞれ x・y パラメータで指定します。

`https://bukiwakaru.herokuapp.com/api/recognition?key={API_KEY}&i=20200407082353f2JDr&x=8&y=219\`

1.  指定した画像の矩形と武器アイコンとのテンプレートマッチングを行う
2.  SINoALICE DataBase 様作成の武器情報 JSON ファイルと照らし合わせ、武器 1 個単位での情報を JSON で出力

「矩形探査 API」で返却された JSON を基に、最大 20 リクエストまでループ処理等を行います。

### 成功時レスポンス例

```json
{
  "id": 88,
  "name": "封戒の水音",
  "quest_skill": "騎士の夜想曲(Ⅲ)",
  "gvg_skill": "騎士の夜想曲(Ⅲ)",
  "gvg2_skill": "補助支援(弐)",
  "limit_break_skill": "",
  "rarity": 6,
  "attribute": 2,
  "cost": 16,
  "eq_type": 1
}
```

| id              | name   | quest_skill      | gvg_skill        | gvg2_skill           | limit_break_skill | rarity                          | attribute                  | cost   | eq_type                                                                                 |
| --------------- | ------ | ---------------- | ---------------- | -------------------- | ----------------- | ------------------------------- | -------------------------- | ------ | --------------------------------------------------------------------------------------- |
| 武器アイコン ID | 武器名 | モノガタリスキル | コロシアムスキル | コロシアム補助スキル | 限界突破スキル    | レアリティ（4：S / 5:SS / 6:L） | 属性（1:火 / 2:水 / 3:風） | コスト | 武器種（1：楽器 / 2：魔書 / 3：魔具 / 4：祈祷 / 5：刀剣 / 6：打撃 / 7：射出 / 8：長柄） |

他に JSON 出力が必要な情報がありましたら、[作者の Twitter](https://twitter.com/ryo_hisano) より DM にて申請下さい。

### 失敗時

#### キーの不一致・必須パラメータ不足

```json
{
  "error": "APIキーが正しくないか、必須パラメータがありません"
}
```

#### エラーの場合

```json
{
  "error": "内部エラーです"
}
```
